---
import Layout from '../../layouts/Layout.astro';
import ProjectCard from '../../components/ProjectCard.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');
const sortedProjects = allProjects.sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

// Obtener todos los tags únicos
const allTags = [...new Set(allProjects.flatMap(project => project.data.tags))];
---

<Layout title="Proyectos - Portfolio">
  <section class="py-20">
    <div class="container mx-auto px-4">
      <div class="text-center mb-16">
        <h1 class="text-5xl font-bold text-gray-900 dark:text-white mb-6">
          Mis Proyectos
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          Una colección de proyectos que muestran mi experiencia y pasión por el desarrollo
        </p>
      </div>

      <!-- Filtros por tags -->
      <div class="mb-12">
        <div class="flex flex-wrap justify-center gap-3">
          <button 
            class="filter-btn active px-4 py-2 rounded-full bg-primary-600 text-white font-medium transition-colors"
            data-tag="all"
          >
            Todos
          </button>
          {allTags.map((tag) => (
            <button 
              class="filter-btn px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-primary-100 dark:hover:bg-primary-900 font-medium transition-colors"
              data-tag={tag}
            >
              {tag}
            </button>
          ))}
        </div>
      </div>

      <!-- Grid de proyectos -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="projects-grid">
        {sortedProjects.map((project) => (
          <div class="project-item" data-tags={project.data.tags.join(',')}>
            <ProjectCard 
              title={project.data.title}
              description={project.data.description}
              image={project.data.image}
              tags={project.data.tags}
              slug={project.slug}
            />
          </div>
        ))}
      </div>

      {sortedProjects.length === 0 && (
        <div class="text-center py-12">
          <p class="text-gray-600 dark:text-gray-400 text-lg">
            No hay proyectos disponibles en este momento.
          </p>
        </div>
      )}
    </div>
  </section>
</Layout>

<script>
  // Filtrado por tags
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectItems = document.querySelectorAll('.project-item');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selectedTag = button.dataset.tag;
      
      // Actualizar botones activos
      filterButtons.forEach(btn => {
        btn.classList.remove('active', 'bg-primary-600', 'text-white');
        btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      });
      
      button.classList.add('active', 'bg-primary-600', 'text-white');
      button.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
      
      // Filtrar proyectos
      projectItems.forEach(item => {
        if (selectedTag === 'all' || item.dataset.tags.includes(selectedTag)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });
  });
</script>
